# MCP Server Configuration

This project uses Model Context Protocol (MCP) servers to enhance development capabilities. The configuration is stored in `.mcp.json` and is checked into version control so all team members have access to the same tools.

## Configured MCP Servers

### Playwright MCP Server

**Purpose**: Browser automation and E2E testing for Tauri applications

**Configuration**:
- **Browser**: Chromium
- **Mode**: Headed (visible browser for debugging)
- **Package**: `@playwright/mcp@latest`

**Capabilities**:
- Navigate to URLs and interact with web pages
- Click elements, type text, submit forms
- Take screenshots and record videos
- Inspect page accessibility tree
- Test responsive designs and mobile viewports
- Automate complex user workflows

**Usage**: The Playwright MCP server runs automatically when Claude Code is used. You can ask Claude to:
- "Test the login flow on the Tauri app"
- "Take a screenshot of the dashboard"
- "Click the submit button and verify the response"
- "Navigate to the settings page and change the theme"

### Ref MCP Server

**Purpose**: Access to up-to-date documentation and API references

**Configuration**:
- **Transport**: HTTP
- **URL**: https://api.ref.tools/mcp
- **Authentication**: API key via environment variable

**Capabilities**:
- Search technical documentation
- Get latest API references
- Access framework and library docs
- Find best practices and examples

**Usage**: Ask Claude to look up documentation:
- "What's the latest Tauri 2.0 API for WebView configuration?"
- "How do I configure Playwright for mobile testing?"
- "Find the OpenRPC specification for authentication"

## Environment Variables

The Ref MCP server requires an API key. Set the following environment variable:

```bash
export REF_API_KEY="your-api-key-here"
```

For persistent configuration, add this to your shell profile (`~/.bashrc`, `~/.zshrc`, etc.):

```bash
echo 'export REF_API_KEY="your-api-key-here"' >> ~/.bashrc
source ~/.bashrc
```

**Note**: Never commit actual API keys to version control. The `.mcp.json` uses `${REF_API_KEY}` as a placeholder that resolves at runtime.

## Prerequisites

### Node.js
Both MCP servers require Node.js 18 or newer:

```bash
node --version  # Should be >= 18.0.0
```

If you need to install or update Node.js:
- **Ubuntu/Debian**: `sudo apt install nodejs npm`
- **macOS**: `brew install node`
- **Windows**: Download from https://nodejs.org/

### NPX
The `npx` command comes with npm 5.2+. Verify it's available:

```bash
npx --version
```

## Configuration File

The `.mcp.json` file structure:

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": [
        "-y",
        "@playwright/mcp@latest",
        "--browser",
        "chromium"
      ],
      "env": {}
    },
    "ref": {
      "transport": "http",
      "url": "https://api.ref.tools/mcp",
      "headers": {
        "x-ref-api-key": "${REF_API_KEY}"
      }
    }
  }
}
```

## Customizing Playwright Configuration

You can modify the Playwright server configuration by changing the `args` array:

### Browser Options
- `--browser chromium` (default)
- `--browser firefox`
- `--browser webkit`

### Display Mode
- Remove `--headless` for visible browser (current setting)
- Add `--headless` for headless mode

### Additional Options
- `--user-data-dir <path>` - Persist browser profile/state
- `--isolated` - Create isolated browser sessions
- `--port <number>` - Set server listening port

Example configuration for Firefox in headless mode:

```json
"playwright": {
  "command": "npx",
  "args": [
    "-y",
    "@playwright/mcp@latest",
    "--browser",
    "firefox",
    "--headless"
  ],
  "env": {}
}
```

## Testing Tauri Applications

When using Playwright MCP with Tauri:

1. **Development Server**: Ensure your Tauri dev server is running:
   ```bash
   npm run tauri dev
   ```

2. **Access the App**: Playwright can interact with the WebView content at the dev server URL (typically `http://localhost:1420` or similar).

3. **E2E Test Workflow**:
   - Ask Claude to navigate to your Tauri app URL
   - Interact with UI elements (buttons, forms, etc.)
   - Verify responses and UI state changes
   - Take screenshots for visual regression testing

4. **Example Commands**:
   ```
   "Navigate to http://localhost:1420 and click the login button"
   "Fill in the username field with 'testuser' and password with 'password123'"
   "Take a screenshot of the dashboard after login"
   "Verify the theme toggle switches between light and dark mode"
   ```

## Troubleshooting

### Playwright Server Not Starting

**Issue**: `npx @playwright/mcp@latest` fails

**Solutions**:
1. Clear npm cache: `npm cache clean --force`
2. Update npm: `npm install -g npm@latest`
3. Manually install: `npm install -g @playwright/mcp`

### Browser Not Visible

**Issue**: Browser runs in headless mode despite configuration

**Solution**: Ensure `--headless` is NOT in the args array in `.mcp.json`

### Ref Server Authentication Fails

**Issue**: "Unauthorized" or "Invalid API key"

**Solutions**:
1. Verify environment variable is set: `echo $REF_API_KEY`
2. Restart your terminal/IDE after setting the variable
3. Check for typos in the API key

### Permission Denied

**Issue**: Cannot execute npx or access browser

**Solutions**:
1. Check Node.js installation: `which node`
2. Verify npm permissions: `npm config get prefix`
3. On Linux, ensure you're not running as root unnecessarily

## Adding More MCP Servers

To add additional MCP servers to this project:

1. Edit `.mcp.json`
2. Add a new entry under `mcpServers`
3. Commit the changes to version control
4. Document the new server in this file

Example structure:

```json
{
  "mcpServers": {
    "existing-server": { ... },
    "new-server": {
      "command": "command-to-run",
      "args": ["arg1", "arg2"],
      "env": {
        "ENV_VAR": "value"
      }
    }
  }
}
```

## References

- [Playwright MCP Server](https://github.com/microsoft/playwright-mcp)
- [Ref MCP Documentation](https://api.ref.tools/)
- [Claude Code MCP Guide](https://docs.claude.com/en/docs/claude-code/mcp)
- [Tauri Testing Guide](https://tauri.app/v2/guides/testing/)

## Support

If you encounter issues with MCP servers:

1. Check this documentation first
2. Review the server-specific documentation (links above)
3. Verify environment variables and prerequisites
4. Check Claude Code logs for error messages

---

Last Updated: 2025-10-06
